<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSP Examples</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #f8f9fa;
            padding: 2rem;
            border-radius: 5px;
            margin-bottom: 2rem;
        }
        .section {
            margin-bottom: 3rem;
        }
        h2 {
            color: #0066cc;
            margin-top: 2rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        h3 {
            color: #0066cc;
            margin-top: 1.5rem;
        }
        pre {
            background-color: #f5f5f5;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        .footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid #eee;
            color: #666;
        }
        .nav-item {
            margin-right: 1rem;
        }
        .example-card {
            margin-bottom: 2rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .example-card .card-header {
            background-color: #0066cc;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>PSP Examples</h1>
        <p class="lead">Implementation examples for different frameworks</p>
        <nav class="nav">
            <a class="nav-link" href="../">Home</a>
            <a class="nav-link" href="#playwright">Playwright</a>
            <a class="nav-link" href="#selenium">Selenium</a>
            <a class="nav-link" href="#custom">Custom Implementation</a>
        </nav>
    </div>

    <div class="section" id="playwright">
        <h2>Playwright Examples</h2>
        
        <div class="example-card card">
            <div class="card-header">
                Basic Authentication Example
            </div>
            <div class="card-body">
                <p class="card-text">Capture a logged-in session and reuse it later:</p>
                <pre><code class="language-javascript">import { chromium } from 'playwright';
import { PlaywrightAdapter } from '@psp/playwright';
import * as fs from 'fs';

async function saveAuthSession() {
  // Launch a browser
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();
  
  // Create a PSP session
  const adapter = new PlaywrightAdapter();
  const session = await adapter.createSession(page, {
    name: 'github-login',
    description: 'GitHub authenticated session'
  });
  
  // Navigate to GitHub login
  await page.goto('https://github.com/login');
  
  // Fill in the login form
  await page.fill('#login_field', 'your-username');
  await page.fill('#password', 'your-password');
  await page.click('input[type="submit"]');
  
  // Wait for navigation to complete
  await page.waitForURL('https://github.com/');
  
  // Capture the authenticated session
  await session.capture();
  
  // Save the session ID for later use
  const sessionId = session.getId();
  fs.writeFileSync('github-session.txt', sessionId);
  
  console.log(`Session saved with ID: ${sessionId}`);
  
  await browser.close();
}

async function loadAuthSession() {
  // Load the session ID
  const sessionId = fs.readFileSync('github-session.txt', 'utf8').trim();
  
  // Launch a new browser
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();
  
  // Create a PSP adapter
  const adapter = new PlaywrightAdapter();
  
  // Load the saved session
  const session = await adapter.loadSession(sessionId);
  
  // Restore the session to the new browser
  await session.restore(page);
  
  // Navigate to a page that requires authentication
  await page.goto('https://github.com/settings/profile');
  
  // The page should load without requiring login
  console.log('Session restored successfully!');
}

// Run the example
// saveAuthSession();
// or
// loadAuthSession();</code></pre>
            </div>
        </div>

        <div class="example-card card">
            <div class="card-header">
                Session Recording and Playback
            </div>
            <div class="card-body">
                <p class="card-text">Record user interactions and play them back:</p>
                <pre><code class="language-javascript">import { chromium } from 'playwright';
import { PlaywrightAdapter } from '@psp/playwright';

async function recordUserActions() {
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();
  
  const adapter = new PlaywrightAdapter();
  const session = await adapter.createSession(page, {
    name: 'recorded-session',
    description: 'Session with recorded user actions'
  });
  
  // Navigate to a website
  await page.goto('https://todomvc.com/examples/vanilla-es6/');
  
  // Start recording user actions
  await session.startRecording();
  
  // Perform some actions
  await page.fill('.new-todo', 'Buy groceries');
  await page.press('.new-todo', 'Enter');
  
  await page.fill('.new-todo', 'Clean the house');
  await page.press('.new-todo', 'Enter');
  
  await page.fill('.new-todo', 'Pay bills');
  await page.press('.new-todo', 'Enter');
  
  // Mark the first item as completed
  await page.click('.todo-list li:first-child .toggle');
  
  // Stop recording
  await session.stopRecording();
  
  // Capture the final state
  await session.capture();
  const sessionId = session.getId();
  
  console.log(`Recorded session saved with ID: ${sessionId}`);
  
  await browser.close();
  return sessionId;
}

async function playbackUserActions(sessionId) {
  const browser = await chromium.launch({ headless: false });
  const context = await browser.newContext();
  const page = await context.newPage();
  
  const adapter = new PlaywrightAdapter();
  const session = await adapter.loadSession(sessionId);
  
  // Navigate to the same website
  await page.goto('https://todomvc.com/examples/vanilla-es6/');
  
  // Restore the session state
  await session.restore(page);
  
  // Play back the recorded actions
  await session.playRecording(page, {
    speed: 0.5  // Slow playback for demonstration
  });
  
  console.log('Playback completed');
}

// Run the example
// recordUserActions().then(sessionId => {
//   setTimeout(() => playbackUserActions(sessionId), 5000);
// });</code></pre>
            </div>
        </div>
    </div>

    <div class="section" id="selenium">
        <h2>Selenium Examples</h2>
        
        <div class="example-card card">
            <div class="card-header">
                Basic Authentication Example
            </div>
            <div class="card-body">
                <p class="card-text">Capture a logged-in session and reuse it later:</p>
                <pre><code class="language-javascript">const { Builder, By } = require('selenium-webdriver');
const { SeleniumAdapter } = require('@psp/selenium');
const fs = require('fs');

async function saveAuthSession() {
  // Initialize driver
  const driver = await new Builder().forBrowser('chrome').build();
  
  // Create adapter and session
  const adapter = new SeleniumAdapter();
  const session = await adapter.createSession(driver, {
    name: 'github-login',
    description: 'GitHub authenticated session'
  });
  
  // Navigate to GitHub login
  await driver.get('https://github.com/login');
  
  // Fill in the login form
  await driver.findElement(By.id('login_field')).sendKeys('your-username');
  await driver.findElement(By.id('password')).sendKeys('your-password');
  await driver.findElement(By.name('commit')).click();
  
  // Wait for navigation to complete
  await driver.wait(() => {
    return driver.getCurrentUrl().then(url => url.includes('github.com') && !url.includes('login'));
  }, 5000);
  
  // Capture the authenticated session
  await session.capture();
  
  // Save the session ID for later use
  const sessionId = session.getId();
  fs.writeFileSync('github-session.txt', sessionId);
  
  console.log(`Session saved with ID: ${sessionId}`);
  
  await driver.quit();
}

async function loadAuthSession() {
  // Load the session ID
  const sessionId = fs.readFileSync('github-session.txt', 'utf8').trim();
  
  // Initialize a new driver
  const driver = await new Builder().forBrowser('chrome').build();
  
  // Create adapter
  const adapter = new SeleniumAdapter();
  
  // Load the saved session
  const session = await adapter.loadSession(sessionId);
  
  // Restore the session to the new driver
  await session.restore(driver);
  
  // Navigate to a page that requires authentication
  await driver.get('https://github.com/settings/profile');
  
  // The page should load without requiring login
  console.log('Session restored successfully!');
}

// Run the example
// saveAuthSession();
// or
// loadAuthSession();</code></pre>
            </div>
        </div>
    </div>

    <div class="section" id="custom">
        <h2>Custom Implementation</h2>
        
        <div class="example-card card">
            <div class="card-header">
                Custom Storage Provider
            </div>
            <div class="card-body">
                <p class="card-text">Implement a custom storage provider:</p>
                <pre><code class="language-typescript">import { StorageProvider, StoredSession, SessionFilter, SessionMetadata } from '@psp/core';

// Example custom storage provider using AWS S3
export class S3StorageProvider implements StorageProvider {
  private s3Client: AWS.S3;
  private bucketName: string;
  
  constructor(options: { 
    bucketName: string,
    region?: string,
    credentials?: { 
      accessKeyId: string, 
      secretAccessKey: string 
    }
  }) {
    const AWS = require('aws-sdk');
    
    this.bucketName = options.bucketName;
    this.s3Client = new AWS.S3({
      region: options.region || 'us-east-1',
      credentials: options.credentials
    });
  }
  
  async save(session: StoredSession): Promise<void> {
    // Serialize the session state
    const serializedState = this.serializeState(session.state);
    
    // Create the serialized session
    const serializedSession = {
      metadata: session.metadata,
      state: serializedState
    };
    
    // Upload to S3
    await this.s3Client.putObject({
      Bucket: this.bucketName,
      Key: `sessions/${session.metadata.id}.json`,
      Body: JSON.stringify(serializedSession),
      ContentType: 'application/json'
    }).promise();
  }
  
  async load(id: string): Promise<StoredSession> {
    // Get the session from S3
    const response = await this.s3Client.getObject({
      Bucket: this.bucketName,
      Key: `sessions/${id}.json`
    }).promise();
    
    // Parse the session data
    const serializedSession = JSON.parse(response.Body.toString());
    
    // Deserialize the state
    const deserializedState = this.deserializeState(serializedSession.state);
    
    return {
      metadata: serializedSession.metadata,
      state: deserializedState
    };
  }
  
  async delete(id: string): Promise<void> {
    await this.s3Client.deleteObject({
      Bucket: this.bucketName,
      Key: `sessions/${id}.json`
    }).promise();
  }
  
  async list(filter?: SessionFilter): Promise<SessionMetadata[]> {
    // List objects in the sessions/ prefix
    const response = await this.s3Client.listObjectsV2({
      Bucket: this.bucketName,
      Prefix: 'sessions/'
    }).promise();
    
    // Get metadata for each session
    const metadataPromises = response.Contents.map(async (obj) => {
      const objResponse = await this.s3Client.getObject({
        Bucket: this.bucketName,
        Key: obj.Key
      }).promise();
      
      const sessionData = JSON.parse(objResponse.Body.toString());
      return sessionData.metadata;
    });
    
    let metadata = await Promise.all(metadataPromises);
    
    // Apply filters
    if (filter) {
      if (filter.name) {
        metadata = metadata.filter(m => 
          m.name.toLowerCase().includes(filter.name.toLowerCase())
        );
      }
      
      if (filter.tags && filter.tags.length > 0) {
        metadata = metadata.filter(m => 
          filter.tags.every(tag => m.tags?.includes(tag))
        );
      }
      
      // Sort by updated time (newest first)
      metadata.sort((a, b) => b.updatedAt - a.updatedAt);
      
      // Apply offset and limit
      if (filter.offset || filter.limit) {
        const offset = filter.offset || 0;
        const limit = filter.limit;
        
        metadata = metadata.slice(offset, limit ? offset + limit : undefined);
      }
    }
    
    return metadata;
  }
  
  async exists(id: string): Promise<boolean> {
    try {
      await this.s3Client.headObject({
        Bucket: this.bucketName,
        Key: `sessions/${id}.json`
      }).promise();
      return true;
    } catch (error) {
      if (error.code === 'NotFound') {
        return false;
      }
      throw error;
    }
  }
  
  // Helper methods to handle serialization and deserialization
  private serializeState(state: any): any { /* ... */ }
  private deserializeState(state: any): any { /* ... */ }
}</code></pre>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>PersistentSessionsProtocol Â© 2023 | <a href="https://github.com/samihalawa/PSP-PersistentSessionsProtocol">GitHub</a></p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre code').forEach((el) => {
                hljs.highlightElement(el);
            });
        });
    </script>
</body>
</html>